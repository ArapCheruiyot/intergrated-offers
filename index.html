<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive File Parser</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        /* Same styles as before */
    </style>
</head>
<body>
<div class="container">
    <h2>Google Drive File Parser</h2>

    <!-- Authentication Button -->
    <button id="authorizeButton">Authorize Google Drive</button>

    <!-- File List from Google Drive -->
    <div class="file-list" id="fileList">
        <h3>Files on Google Drive:</h3>
    </div>

    <!-- Search Box -->
    <input type="text" id="searchInput" placeholder="Enter customer number">
    <button id="searchButton">Search</button>

    <!-- Result Display -->
    <div id="resultContainer"></div>
</div>

<script>
    const CLIENT_ID = '361306676979-daeqed946lct73e84fu6t16i38u2ialv.apps.googleusercontent.com'; // Replace with your Client ID
    const API_KEY = 'YOUR_GOOGLE_API_KEY'; // Replace with your API Key
    const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';
    let fileData = {};

    // Load the Google API client
    function handleClientLoad() {
        gapi.load('client:auth2', initClient);
    }

    function initClient() {
        gapi.client.init({
            apiKey: API_KEY,
            clientId: CLIENT_ID,
            scope: SCOPES
        }).then(() => {
            const authorizeButton = document.getElementById('authorizeButton');
            authorizeButton.onclick = handleAuthClick;
        });
    }

    function handleAuthClick() {
        gapi.auth2.getAuthInstance().signIn().then(listFiles);
    }

    function listFiles() {
        gapi.client.drive.files.list({
            pageSize: 10,
            fields: 'files(id, name, mimeType)'
        }).then(response => {
            const files = response.result.files;
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '<h3>Files on Google Drive:</h3>';

            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.classList.add('file-item');
                fileItem.textContent = file.name;
                fileItem.dataset.fileId = file.id;
                fileItem.onclick = () => fetchFile(file.id, file.name);
                fileList.appendChild(fileItem);
            });
        });
    }

    function fetchFile(fileId, fileName) {
        gapi.client.drive.files.get({
            fileId: fileId,
            alt: 'media'
        }).then(response => {
            const workbook = XLSX.read(response.body, { type: 'binary' });
            let allData = [];

            workbook.SheetNames.forEach(sheetName => {
                const rows = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
                allData = allData.concat(rows);
            });

            fileData[fileName] = allData;
            alert(`${fileName} loaded successfully!`);
        });
    }

    document.getElementById('searchButton').addEventListener('click', () => {
        const customerNumber = document.getElementById('searchInput').value.trim();
        const resultContainer = document.getElementById('resultContainer');
        resultContainer.innerHTML = '';

        let found = false;
        for (const fileName in fileData) {
            const data = fileData[fileName];
            for (const row of data) {
                if (row.some(cell => String(cell).trim() === customerNumber)) {
                    resultContainer.innerHTML += `<div class="result">Found in ${fileName}: ${row.join(', ')}</div>`;
                    found = true;
                    break;
                }
            }
        }

        if (!found) {
            resultContainer.innerHTML = '<div class="no-result">Customer not found.</div>';
        }
    });

    handleClientLoad(); // Initialize Google API
</script>
</body>
</html>
